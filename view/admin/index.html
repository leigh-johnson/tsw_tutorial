## served on
<%inherit file="../base.html"/>
<%def name="path()">
../
</%def>
<%block name='head'>
${parent.head()}
<link href="${path()+'public/css/reset.css'}" rel='stylesheet' type='text/css' />
<link href="${path()+'public/css/style.css'}" rel='stylesheet' type='text/css' />
<link href="${path()+'public/css/admin.css'}" rel='stylesheet' />
</%block>
<%block name='menu'>
<div id="accordion-top">
<ol id="sortable-public" class="sortable sortable-item">
Published
%for row in categories:
	 ##Top level categories
	%if row.is_category == True & row.public == True & (row.parent_id is None):
	<li class="accordion-top-header sortable-item" id="${row._id}"><a href="article?_id=${row._id}" data-order="${row.order}">${getattr(row, 'title_'+lang)}</a></li>
	<ol>
	##children 
		%for article in row.articles:
			##If child has children
			%if article.is_category == True:
				<div id="accordion-sub">
				<li class="sortable-item accordion-sub-header" data-order="${article.order}"><a href="article?_id=${article._id}" data-order="${row.order}">${getattr(article, 'title_'+lang)}</a></li>
				<ol class="sortable sortable-item">
				%for nested_article in article.articles:
					<li class="sortable-item" data-order="${article.order}"><span class="${article.icon}"></span>${getattr(nested_article, 'title_'+lang)}</li>
				%endfor
				</ol>
				</div>
			%else:
			<li class="sortable-item" data-order="${article.order}"><span class="${article.icon}"></span>${getattr(article, 'title_'+lang)}</li>
			%endif
		%endfor

	</ol>
	%endif
%endfor
</ol>
</div>
<ol id="sortable-private" class="sortable">Private
	<li><a href="/admin/new">Create new...</a></li>
	%for row in categories:
		%if row.public == False:
		<li class="sortable-item" id="${row._id}" data-order="${row.order}"><a href="article?_id=${row._id}">${getattr(row, 'title_'+lang)}</a></li>
		%endif
	%endfor
</ol>
</%block>
## Select a language

<%block name="content">

<h1>Welcome to the admin panel</h1>
<p>Use tutorial goes here</p>
</%block>
<%block name="footer">
	<h3>Hello $admin</h3>
	<button>Logout</button>
	<%block name="language">
	<fieldset>
	<label for="language">Select lang:</label>
	    <select name="language" id="language">
	      <option value='en'>EN</option>
	      <option value='fr'>FR</option>
	      <option value='de'>DE</option>
	    <option value=None>ALL (TODO)</option>
	    </select>
	    <button id='language_submit'>View</button>
	</fieldset>

	Current lang: ${lang}

	<script type='text/javascript'>
	$( document ).ready(function() {
		// AJAX defaults
		$.ajaxSetup({
			contentType: 'application/json; charset=utf-8',
			dataType: 'text json',
		error: function(data) {
			$('<div class="flash-error"><span>CONNECTION ERROR - PLEASE RESAVE!</span></div>').appendTo($('#footer')).fadeIn(500).delay(2600).fadeOut(500);
		    },
		success: function() {
			$('<div class="flash-success"><span>SAVED ^^V</span></div>').appendTo($('#footer')).fadeIn(500).delay(2600).fadeOut(500);	

			}			
		});
		$('#language_submit').click(function(event) {
			lang = $('#language').val();
			var hostname = window.location.hostname

			//req to AdminController.setLang() 
			$.ajax({
				type: 'GET',
				url: '/admin/setLang?lang='+lang,
				success: function(){
					location.reload();
				}
			});
		});

		$('')

		// jquery sortable
		$('#sortable-public, #sortable-private').sortable({
			connectWith: '.sortable',
			placeholder: 'sortable-placeholder',
			forcePlaceholderSize: true,
			items: '.sortable-item'
	    	});    	
	});
	</script>
	</%block>
	<div>
	Create new:
	<a href="${path()+'admin/new'}"><button>Article</button></a>
	</%block>
	<%block name='scripts'>
	<script type='text/javascript' src='${path()+"public/js/menu.js"}'></script>
	</div>
</%block>