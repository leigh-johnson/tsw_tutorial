## served on
<%inherit file="../base.html"/>
<%def name="path()">
../
</%def>
<%block name='head'>
${parent.head()}
<link href="${path()+'public/css/reset.css'}" rel='stylesheet' type='text/css' />
<link href="${path()+'public/css/style.css'}" rel='stylesheet' type='text/css' />
<link href="${path()+'public/css/admin.css'}" rel='stylesheet' />

<script src="${path()+'public/js/jquery-sortable.js'}" type='text/javascript'></script>
</%block>
<%block name='menu'>
<div id="accordion" class="connected-sortable">
<div id="accordion">
<ol id="sortable-public" class="sortable">
Published
%for row in categories:
	%if row.is_category == True & row.public == True:
	<li class="accordion-header" id="${row._id}"><a href="article?_id=${row._id}" alt="${getattr(row, 'description_'+lang)}">${getattr(row, 'title_'+lang)}</a></li>
	<ol class="accordion-content">
	%for article in row.articles:
		<li><span class="${article.icon}"></span>
	<a href="article?_id=${article._id}" alt="${getattr(article, 'description_'+lang)}">${getattr(article, 'title_'+lang)}</a></li>	
	%endfor
	%endif
	</ol>
%endfor
</ol>
</div>
<ol id="sortable-private" class="sortable">Private
	%for row in categories:
		%if row.public == False:
		<li><a href="article?_id=${row._id}" alt="${getattr(row, 'description_'+lang)}">${getattr(row, 'title_'+lang)}</a></li>
		%endif
	%endfor
</ol>
</%block>
## Select a language

<%block name="content">

<h1>Welcome to the admin panel</h1>
<p>Use tutorial goes here</p>
</%block>
<%block name="footer">
	<h3>Hello $admin</h3>
	<button>Logout</button>
	<%block name="language">
	<fieldset>
	<label for="language">Select lang:</label>
	    <select name="language" id="language">
	      <option value='en'>EN</option>
	      <option value='fr'>FR</option>
	      <option value='de'>DE</option>
	    <option value=None>ALL (TODO)</option>
	    </select>
	    <button id='language_submit'>View</button>
	</fieldset>

	Current lang: ${lang}

	<script type='text/javascript'>
	$( document ).ready(function() {
		// AJAX defaolts
		$.ajaxSetup({
			contentType: 'application/json; charset=utf-8',
			dataType: 'text json',
		error: function(data) {
			$('<div class="flash-error"><span>CONNECTION ERROR - PLEASE RESAVE!</span></div>').appendTo($('#footer')).fadeIn(500).delay(2600).fadeOut(500);
		    },
		success: function() {
			$('<div class="flash-success"><span>SAVED ^^V</span></div>').appendTo($('#footer')).fadeIn(500).delay(2600).fadeOut(500);	

			}			
		});
		$('#language_submit').click(function(event) {
			lang = $('#language').val();
			var hostname = window.location.hostname

			//request to AdminController.setLang() route
			$.ajax({
				type: 'GET',
				url: '/admin/setLang?lang='+lang,
				success: function(){
					location.reload();
				}
			});
		});

		$('')

		// jquery-sortable http://github.com/johnny/jquery-sortable
		var adjustment;
		$("ol.sortable").sortable({
			group: 'sortable',
			pullPlaceholder: false,
			// animation on drop
			onDrop: function(item, targetContainer, _super){
				var clonedItem = $('<li/>').css({height:0});
				item.before(clonedItem)
				clonedItem.animate({'height': item.height()})

				item.animate(clonedItem.position(), function (){
					clonedItem.detach()
					_super(item)
				});
			},
			onDragStart: function($item, container, _super){
				var offset = $item.offset(),
				pointer = container.rootGroup.pointer

				adjustment = {
					left: pointer.left - offset.left,
					top: pointer.top - offset.top
				}
				_super($item, container)
			},

			onDrag: function($item, position){
				$item.css({
					left: position.left - adjustment.left,
					top: position.top - adjustment.top
				})
			}
		});
	});
	</script>
	</%block>
	<div>
	Create new:
	<a href="${path()+'admin/new'}"><button>Article</button></a>
	</%block>
	<%block name='scripts'>
	<script type='text/javascript' src='${path()+"public/js/menu.js"}'></script>
	</div>
</%block>