## served on
<%inherit file="../base.html"/>
<%def name="path()">
../
</%def>
<%block name='head'>
${parent.head()}
<link href="${path()+'public/css/reset.css'}" rel='stylesheet' type='text/css' />
<link href="${path()+'public/css/style.css'}" rel='stylesheet' type='text/css' />
<link href="${path()+'public/css/admin.css'}" rel='stylesheet' />
</%block>
<div id="wrapper">
<%block name='menu'>
<div id="menu" class="accordion">
<ol class="sortable">Published

## categories sorted by SQLalchemy's order_by()
## @todo should really use a recursive algorithm to traverse each Article().articles

%for row in categories:
	 ##Top level categories
	%if row.is_category == True & row.is_public == True & (row.parent_id is None):
	<li id="${'article_'+str(row._id)}">
		<div class="sortable-wrapper accordion-header">
			<span class="icon-plus accordion-icon">
			</span>
			<a href="article?_id=${row._id}">${getattr(row, 'title_'+lang)}</a>
		</div>
		## Category roll of articles
		<ol>
			%for article in row.articles:
				##If child has children
				%if article.is_category == True:
					<li data-order="${article.order}" id="${'article_'+str(article._id)}">
						<div class="accordion-header sortable-wrapper">
							<span class="icon-plus accordion-icon"></span>
							<a href="article?_id=${article._id}">${getattr(article, 'title_'+lang)}</a>
						</div>
						## Article roll, if subcategory
						<ol>
						%for nested_article in article.articles:
							%if nested_article.is_category == True:
								<li id="${'article_'+str(nested_article._id)}">
									<div class="accordion-header sortable-wrapper">
									<span class="icon-plus accordion-icon"></span>
									<a href="article?_id=${nested_article._id}">${getattr(nested_article, 'title_'+lang)}</a>
									</div>
									<ol>
									%for sub_article in nested_article.articles:
										<li id="${'article_'+str(sub_article._id)}">
										<div class="accordion-header sortable-wrapper">
											<span class="${article.icon}"></span>
											<a href="article?_id=${sub_article._id}">${getattr(sub_article, 'title_'+lang)}</a>
										</div>
										</li>
									%endfor
									</ol>
								</li>
							%else:
								<li id="${'article_'+str(nested_article._id)}">
									<div class="accordion-header sortable-wrapper">
										<span class="${article.icon}"></span>
										<a href="article?_id=${nested_article._id}">${getattr(nested_article, 'title_'+lang)}</a>
									</div>
								</li>
							%endif
						%endfor
						</ol>
					</li>
				%else:
				<li id="${'article_'+str(article._id)}">
					<div class="sortable-wrapper">
					<span class="${article.icon}"></span>
					<a href="article?_id=${article._id}">${getattr(article, 'title_'+lang)}</a>
					</div>
				</li>
				%endif
			%endfor
		</ol>
	</li>
	%endif
%endfor
</ol>
<ol>Private
	<li><a href="/admin/new">Create new...</a></li>
	%for row in categories:
		%if row.is_public == False:
		<li id="${row._id}" data-order="${row.order}"><a href="article?_id=${row._id}">${getattr(row, 'title_'+lang)}</a></li>
		%endif
	%endfor
</ol>
</div>
</%block>
## Select a language

<%block name="content">

<h1>Welcome to the admin panel</h1>
<p>Use tutorial goes here</p>
</%block>
</div> <!-- End #wrapper -->

<%block name="footer">
	<h3>Hello $admin</h3>
	<button>Logout</button>
	<%block name="language">
	<div class="divider">View Options</div>
	<fieldset>
	<label for="language">Select lang:</label>
	    <select name="language" id="language">
	      <option value='en'>EN</option>
	      <option value='fr'>FR</option>
	      <option value='de'>DE</option>
	    <option value=None>ALL @todo</option>
	    </select>
	    <button id='language_submit'>View</button>
	<p>	Current lang: ${lang}</p>

	</fieldset>
	</%block>
	<div>

	<a href="${path()+'admin/new'}"><button>New Article</button></a>
	<a href="${path()+'admin/tags'}"><button>All Tags</button></a>

	## Article options

	## Change layout
	<div id="edit_article">
	<div class="divider">Article Options</div>
	<div class="toggle"><input type="checkbox" value="1" checked></div>
	## Assign to parent
	<div id="article_options">
	<select id="set_parent_id">
	<option value="" disabled selected>Assign to Category</option>
	%for row in categories:
		%if row.is_category == True and (row.parent_id is None):
			<option value="${row._id}">${row.title_en}</option>
			%for article in row.articles:
				%if article.is_category == True & (row._id == article.parent_id):
				<option value="${article._id}"> >>${article.title_en}</option>
				%endif
			%endfor
		%endif
	%endfor
	</select>

	<label for="is_category">Is this a category? <br>Only categories can have children.</label>
	<select id="set_is_category">
		<option value="" disabled selected>Is this a category?</option>
		<option value=0>No</option>
		<option value=1>Yes</option>
	</select>

	<label for="set_is_public">Publish?</label>
	<select id="set_is_public">
		<option value="" disabled selected>Publish this article?</option>
		<option value=0>No</option>
		<option value=1>Yes</option>
	</select>


	<div class="divider">Template, Icons</div>
	<label for="set_layout">Choose a template/layout</label>
	<select id="set_layout">
		<option value="" disabled selected>Template</option>
		<option value="default">Text+Imgs (default)</option>
		<option value="video">Video</option>
		<option value="text">Text base</option>
	</select>

	<label for="set_icon">Choose an icon</label>
	<select id="set_icon" style="font-family:'icomoon'; font-size: 1em;"required>
	<option value="icon-file-text">&#xe926;</span></option>
	<option value="icon-file-picture">&#xe927;</option>
	<option value="icon-file-video">&#xe92a;</option>
	</select>

	<div class="divider">LUA, Tags</div>

	<label for="set_tag">Add a tag?</label>
	<select id="set_tag"> 
	%for tag in tags:
		<option value="${tag._id}">${tag.title_en}</option>
	%endfor
	</select>

	<div class="divider">Delete</div>
	<button id="delete_article">Delete</button>
	</div>
	<%block name="error">
	<div id="error"></div>
	</div>
	</%block>
	</%block>

<%block name='scripts'>
	<script type='text/javascript' src='${path() + "public/js/jquery-nestedSortable.js"}'></script>
	<script type='text/javascript' src='${path()+"public/js/menu.js"}'></script>
	<script type='text/javascript' src='${path()+"public/js/jquery.switchButton.js"}'></script>
	<script src="${path()+'public/js/admin.js'}"type='text/javascript'>
	</script>
	${parent.scripts()}
</%block>
