##  actually the article-default template
<%inherit file="../index.html"/>
<%block name='head'>
${parent.head()}
## load faction-specific stylesheet
<script src="../public/ckeditor/ckeditor.js" type="text/javascript"></script>
</%block>
<%block name='menu'>
${parent.menu()}
</%block>
<%block name="content">

## default layout: category
%if article.is_category == True:
	<h1 id="${'title_'+lang}" contenteditable="true">${getattr(article, 'title_'+lang)}</h1>
	##<h3 id="${'description_'+lang}" contenteditable="true">${getattr(article, 'description_'+lang)}</h3>
	%if article.banner_src:
		<div contenteditable="true" id="banner_src"><img src="${article.banner_src}"></img></div>
	%endif
	
	## Enumerate body text instances
	%for i, body in enumerate(getattr(article, 'body_'+lang)):
		<div class="article-body" id="${'body_'+lang+'_'+str(body._id)}" contenteditable="true">${body.text}</div>
	%endfor

	<button>Add Widget @todo</button>

	## Enumerate article instances
	%for summary in article.articles:
		<figure>
		<figcaption>
		<h3>${getattr(summary, 'title_'+lang)}</h3>
		</figcaption>
		</figure>
	%endfor

## default layout: article/non-category
%else:
%endif

<div id="tags">
%for tag in article.tags:
	 <a href="${'search?tag='+getattr(tag, "title_"+lang)}"><span class="badge">${getattr(tag, "title_"+lang)}</span>
%endfor
</div>

## Persist ckeditor instances
<script>
$(document).ready(function() {
	// Ckeditor 
		var article_id = window.location.search
		$("[contenteditable='true']").each(function( index ) {

				var column_id = $(this).attr('id');
				CKEDITOR.inline( column_id, {
						on: {
								blur: function( event ) {
									var data = {}
									// strip surrounding html from banner, save only src
									if(column_id != 'banner_src'){
										data[column_id] = event.editor.getData();
										}
										else{
											var banner_img = $('#banner_src img');
											data[column_id] = banner_img.attr('src');
										}

										var request = $.ajax({
											type:'PUT',
											url: './api/article'+article_id,
											headers: {'X-Ckeditor-Edit': JSON.stringify(data)},
											processData: false,
											dataType: 'json'
										});

								}
						}
				});

		});

		

});

</script>
</%block>
